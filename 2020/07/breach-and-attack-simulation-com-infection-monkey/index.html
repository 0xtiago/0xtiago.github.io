<!DOCTYPE html>
<html lang="en-us">
  <head>
    
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="generator" content="Hugo 0.85.0 with theme Tranquilpeak 0.4.8-BETA">
<meta name="author" content="Tiago Tavares">
<meta name="keywords" content="tech, cybersecurity, information security, running, hacking, programming, offensive security, red team">
<meta name="description" content="Realize simula√ß√µes de ataque em um clique!">


<meta property="og:description" content="Realize simula√ß√µes de ataque em um clique!">
<meta property="og:type" content="article">
<meta property="og:title" content="Breach and Attack Simulation com Infection Monkey üêµ">
<meta name="twitter:title" content="Breach and Attack Simulation com Infection Monkey üêµ">
<meta property="og:url" content="https://tiagotavares.io/2020/07/breach-and-attack-simulation-com-infection-monkey/">
<meta property="twitter:url" content="https://tiagotavares.io/2020/07/breach-and-attack-simulation-com-infection-monkey/">
<meta property="og:site_name" content="debugging the life">
<meta property="og:description" content="Realize simula√ß√µes de ataque em um clique!">
<meta name="twitter:description" content="Realize simula√ß√µes de ataque em um clique!">
<meta property="og:locale" content="en-us">

  
    <meta property="article:published_time" content="2020-07-27T21:00:00">
  
  
    <meta property="article:modified_time" content="2020-07-27T21:00:00">
  
  
  
    
      <meta property="article:section" content="Red Team Operations">
    
  
  
    
      <meta property="article:tag" content="red team">
    
      <meta property="article:tag" content="breach and attack simulation">
    
      <meta property="article:tag" content="security">
    
      <meta property="article:tag" content="infection monkey">
    
      <meta property="article:tag" content="hacking">
    
      <meta property="article:tag" content="guardicore">
    
      <meta property="article:tag" content="resili√™ncia">
    
  


<meta name="twitter:card" content="summary">

  <meta name="twitter:site" content="@0xtiago">


  <meta name="twitter:creator" content="@0xtiago">






  <meta property="og:image" content="https://res.cloudinary.com/dtr6hzxnx/image/upload/v1595895665/blog/tt_2020-07-27_14-02-31_svdo8d.png">
  <meta property="twitter:image" content="https://res.cloudinary.com/dtr6hzxnx/image/upload/v1595895665/blog/tt_2020-07-27_14-02-31_svdo8d.png">


  <meta property="og:image" content="https://res.cloudinary.com/dtr6hzxnx/image/upload/v1595897114/blog/Red_f3ifri.jpg">
  <meta property="twitter:image" content="https://res.cloudinary.com/dtr6hzxnx/image/upload/v1595897114/blog/Red_f3ifri.jpg">




  <meta property="og:image" content="https://www.gravatar.com/avatar/e68e9fb3fa89ea576f47c7ef05d17448?s=640">
  <meta property="twitter:image" content="https://www.gravatar.com/avatar/e68e9fb3fa89ea576f47c7ef05d17448?s=640">


    <title>Breach and Attack Simulation com Infection Monkey üêµ</title>

    <link rel="icon" href="images/favicon-32x32.png">
    

    

    <link rel="canonical" href="https://tiagotavares.io/2020/07/breach-and-attack-simulation-com-infection-monkey/">

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/jquery.fancybox.min.css" integrity="sha256-vuXZ9LGmmwtjqFX1F+EKin1ThZMub58gKULUyf0qECk=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/helpers/jquery.fancybox-thumbs.min.css" integrity="sha256-SEa4XYAHihTcEP1f5gARTB2K26Uk8PsndQYHQC1f4jU=" crossorigin="anonymous" />
    
    
    <link rel="stylesheet" href="https://tiagotavares.io/css/style-twzjdbqhmnnacqs0pwwdzcdbt8yhv8giawvjqjmyfoqnvazl0dalmnhdkvp7.min.css" />
    
    

    
      
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-36987137-3', 'auto');
	
	ga('send', 'pageview');
}
</script>
    
    
  </head>

  <body>
    <div id="blog">
      <header id="header" data-behavior="4">
  <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
  <div class="header-title">
    <a class="header-title-link" href="https://tiagotavares.io/">debugging the life</a>
  </div>
  
    
      <a class="header-right-picture "
         href="https://tiagotavares.io/#about">
    
    
    
      
        <img class="header-picture" src="https://www.gravatar.com/avatar/e68e9fb3fa89ea576f47c7ef05d17448?s=90" alt="Author&#39;s picture" />
      
    
    </a>
  
</header>

      <nav id="sidebar" data-behavior="4">
  <div class="sidebar-container">
    
      <div class="sidebar-profile">
        <a href="https://tiagotavares.io/#about">
          <img class="sidebar-profile-picture" src="https://www.gravatar.com/avatar/e68e9fb3fa89ea576f47c7ef05d17448?s=110" alt="Author&#39;s picture" />
        </a>
        <h4 class="sidebar-profile-name">Tiago Tavares</h4>
        
          <h5 class="sidebar-profile-bio">Eternal student, cybersecurity pro, husband, runner.</h5>
        
      </div>
    
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://tiagotavares.io/">
    
      <i class="sidebar-button-icon fa fa-lg fa-home"></i>
      
      <span class="sidebar-button-desc">Home</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://tiagotavares.io/categories">
    
      <i class="sidebar-button-icon fa fa-lg fa-bookmark"></i>
      
      <span class="sidebar-button-desc">Categories</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://tiagotavares.io/tags">
    
      <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
      
      <span class="sidebar-button-desc">Tags</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://tiagotavares.io/archives">
    
      <i class="sidebar-button-icon fa fa-lg fa-archive"></i>
      
      <span class="sidebar-button-desc">Archives</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://tiagotavares.io/#about">
    
      <i class="sidebar-button-icon fa fa-lg fa-question"></i>
      
      <span class="sidebar-button-desc">About</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://github.com/0xtiago" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-github"></i>
      
      <span class="sidebar-button-desc">GitHub</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.linkedin.com/in/tiagotvrs/" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-linkedin"></i>
      
      <span class="sidebar-button-desc">LinkedIn</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.strava.com/athletes/tiagotavares" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-heartbeat"></i>
      
      <span class="sidebar-button-desc">Strava</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://twitter.com/0xtiago" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-twitter"></i>
      
      <span class="sidebar-button-desc">Twitter</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://tiagotavares.io/index.xml">
    
      <i class="sidebar-button-icon fa fa-lg fa-rss"></i>
      
      <span class="sidebar-button-desc">RSS</span>
    </a>
  </li>


    </ul>
  </div>
</nav>

      
  <div class="post-header-cover
              text-center
              "
       style="background-image:url('https://res.cloudinary.com/dtr6hzxnx/image/upload/v1595897114/blog/Red_f3ifri.jpg')"
       data-behavior="4">
    
      <div class="post-header main-content-wrap text-center">
  
    <h1 class="post-title" itemprop="headline">
      Breach and Attack Simulation com Infection Monkey üêµ
    </h1>
  
  
  <div class="postShorten-meta post-meta">
    
      <time itemprop="datePublished" datetime="2020-07-27T21:00:00-03:00">
        
  July 27, 2020

      </time>
    
    
  
  
    <span>in</span>
    
      <a class="category-link" href="https://tiagotavares.io/categories/red-team-operations">Red Team Operations</a>
    
  

  </div>

</div>
    
  </div>


      <div id="main" data-behavior="4"
        class="hasCover
               hasCoverMetaIn
               ">
        <article class="post" itemscope itemType="http://schema.org/BlogPosting">
          
          
          <div class="post-content markdown" itemprop="articleBody">
            <div class="main-content-wrap">
              <p>Realize simula√ß√µes de ataque em um clique!</p>
<h1 id="sum√°rio">Sum√°rio</h1>
<ul>
<li><a href="#sobre-o-infection-monkey-">Sobre o <em>Infection Monkey</em> üêµ</a></li>
<li><a href="#como-funciona">Como funciona?</a></li>
<li><a href="#o-que-a-ferramenta-agrega-a-minha-organiza%C3%A7%C3%A3o">O que a ferramenta agrega a minha organiza√ß√£o?</a></li>
<li><a href="#quais-s%C3%A3o-os-ambientes-suportados">Quais s√£o os ambientes suportados?</a></li>
<li><a href="#setup-do-laborat%C3%B3rio">Setup do laborat√≥rio</a></li>
<li><a href="#procedimento-de-instala%C3%A7%C3%A3o">Procedimento de instala√ß√£o</a></li>
<li><a href="#configura%C3%A7%C3%A3o-e-execu%C3%A7%C3%A3o-dos-ataques">Configura√ß√£o e execu√ß√£o dos ataques</a></li>
<li><a href="#mais-sobre-configura%C3%A7%C3%B5es">Mais sobre configura√ß√µes</a></li>
<li><a href="#relat%C3%B3rios">Relat√≥rios</a></li>
<li><a href="#conclus%C3%A3o-">Conclus√£o</a></li>
</ul>
<h1 id="sobre-o-infection-monkey-">Sobre o <em>Infection Monkey</em> üêµ</h1>
<p>O <a href="https://www.guardicore.com/infectionmonkey/">Infection Monkey</a> √© uma ferramenta <em>open source</em> mantida pela <strong>Guardicore</strong> criada para realizar atividades de simula√ß√£o de ataques e viola√ß√£o de pol√≠ticas de seguran√ßa <em><strong>(BAS - Breach and Attack Simulation)</strong></em>. Seu objetivo √© testar a resili√™ncia de ambientes em redes privadas e nuvens p√∫blicas em um cen√°rio p√≥s-explorat√≥rio (onde o atacante j√° est√° em seu ambiente), com tentativas de viola√ß√£o de pol√≠ticas de seguran√ßa, movimenta√ß√£o lateral e controle total de ambientes, seja ele Windows ou Linux.</p>
<p>Tudo o que √© necess√°rio para baixar e configurar o <strong>Infection Monkey</strong> se encontra em <a href="https://www.guardicore.com/infectionmonkey/">https://www.guardicore.com/infectionmonkey/</a>.</p>
<p><img src="https://res.cloudinary.com/dtr6hzxnx/image/upload/v1595897309/blog/tt_2020-07-27_21-47-53_fpxal1.png" alt=""></p>
<h1 id="como-funciona">Como funciona?</h1>
<p>Ao realizar o deploy de uma inst√¢ncia do Infection Monkey, ele automaticamente realizar√° um discovery de todo o ambiente que ele possa alcan√ßar e avaliar√° os riscos de seguran√ßa com testes para diferentes cen√°rios, como roubo de credenciais, comprometimento de desktops e dom√≠nio, al√©m de outras falhas de seguran√ßa. √â sugerido que realize esta avalia√ß√£o periodicamente, assim √© poss√≠vel descobrir falhas ap√≥s altera√ß√µes na rede.</p>
<p><img src="https://res.cloudinary.com/dtr6hzxnx/image/upload/v1595896039/blog/perifa_map_infection_monkey-1595870511411_g2npxy.png" alt="perifa_map_infection_monkey"></p>
<p>Al√©m de ser bem intuitivo, a solu√ß√£o produz relat√≥rios detalhados com todas as instru√ß√µes de corre√ß√£o e mapas visuais dos pontos de explora√ß√£o, de forma que voc√™ conseguir√° visualizar como sua rede est√° distribu√≠da.</p>
<h1 id="o-que-a-ferramenta-agrega-a-minha-organiza√ß√£o">O que a ferramenta agrega a minha organiza√ß√£o?</h1>
<p><strong>Para os CISOs</strong>, a ferramenta prov√™ resultados quantitativos sobre a exposi√ß√£o aos riscos que podem ajudar na justificativa de investimentos em seguran√ßa.</p>
<p><strong>Para os analistas</strong>, os resultados demonstra os pontos fr√°geis em sua rede, ajudando a priorizar a mitiga√ß√£o destes riscos.</p>
<h1 id="quais-s√£o-os-ambientes-suportados">Quais s√£o os ambientes suportados?</h1>
<p>O Infection Monkey √© bem flex√≠vel em rela√ß√£o aos ambientes que ele pode ser disponibilizado.</p>
<ul>
<li>VMware</li>
<li>AWS</li>
<li>Google Cloud Platform</li>
<li>GCP</li>
<li>Windows</li>
<li>Debian Linux</li>
<li>Docker</li>
</ul>
<h1 id="setup-do-laborat√≥rio">Setup do laborat√≥rio</h1>
<p>O meu laborat√≥rio segue as seguintes caracter√≠sticas para ajudar na demonstra√ß√£o do que a ferramenta √© capaz:</p>
<ul>
<li>Todos os componentes est√£o na mesma VLAN;</li>
<li>Todos os sistemas operacionais est√£o atualizados;</li>
<li>A ferramenta foi configurada para conseguir com sucesso com <em>brute force</em> uma credencial com acesso privilegiado.</li>
</ul>
<div class="alert info ">
  <p>Como pode ver optei por deixar uma brecha (credencial) para observar ao m√°ximo a ferramenta.</p>
</div>
<p>Os componentes do laborat√≥rios s√£o os seguintes?</p>
<table>
<thead>
<tr>
<th>Nome</th>
<th>Fun√ß√£o</th>
<th>IP</th>
</tr>
</thead>
<tbody>
<tr>
<td>DC01.perifa.corp (Windows Server 2016)</td>
<td>Domain Controler</td>
<td>192.168.210.101</td>
</tr>
<tr>
<td>DC02.perifa.corp (Windows Server 2016)</td>
<td>Domain Controler</td>
<td>192.168.210.102</td>
</tr>
<tr>
<td>WKS01.perifa.corp (Windows 10)</td>
<td>Workstation</td>
<td>192.168.210.10</td>
</tr>
<tr>
<td>WKS02.perifa.corp (Windows 10)</td>
<td>Workstation</td>
<td>192.168.210.11</td>
</tr>
<tr>
<td><em><strong>monkey1.perifa.corp (Debian 10)</strong></em></td>
<td><em><strong>Infection Monkey</strong></em></td>
<td><strong>192.168.210.99</strong></td>
</tr>
</tbody>
</table>
<p>O ambiente todo foi constru√≠do em <strong>VMware Workstation</strong>.</p>
<h1 id="procedimento-de-instala√ß√£o">Procedimento de instala√ß√£o</h1>
<p>Na m√°quina <strong>monkey1</strong> j√° instalada, configurada e atualizada, vamos come√ßar a instalar as depend√™ncias iniciais e ferramentas que iremos utilizar no futuro.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo apt install libcurl4 build-essential vim git net-tools
</code></pre></div><p>Gosto de cores no meu terminal, ent√£o se preferir voc√™ pode configurar o seu tamb√©m. =)</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ sudo vim /etc/bash.bashrc
...
export LS_OPTIONS<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;--color=auto&#39;</span>
eval <span style="color:#e6db74">&#34;`dircolors`&#34;</span>
alias ls<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;ls $LS_OPTIONS&#39;</span>

</code></pre></div><p>Solicite o link de download em <a href="https://www.guardicore.com/infectionmonkey/">https://www.guardicore.com/infectionmonkey/</a>. Ap√≥s o o recebimento do link, realize o download.</p>
<p>Descompacte o TAR.GZ.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ tar xvzf monkey-island-debian.tar.gz
README.md
monkey_island_deb.deb
</code></pre></div><p>Instale o pacote .DEB, se aparecer alguns erros fique tranquilo@</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ sudo dpkg -i monkey_island_deb.deb 
</code></pre></div><p>Use o comando APT para instalar todas as depend√™ncias e posteriormente o pacote <strong>monkey_island_deb.deb</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ sudo apt install -f
</code></pre></div><p>O Infection Monkey ser√° instalado e configurado em <code>/var/monkey</code>. Ser√£o instalados dois servi√ßos, o <code>monkey-island</code> (Aplica√ß√£o) e o <code>monkey-mongo</code> (Bando de Dados.)</p>
<p>Abaixo a estrutura de pastas do servi√ßo.</p>
<p><img src="https://res.cloudinary.com/dtr6hzxnx/image/upload/v1595896038/blog/image-20200727210226606_fck3uy.png" alt="image-20200727210226606"></p>
<p>Vamos verificar se  os servi√ßos est√£o ativos est√° ativo.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ sudo systemctl status monkey-*
</code></pre></div><p><img src="https://res.cloudinary.com/dtr6hzxnx/image/upload/v1595896196/blog/image-20200724120502719_mw1chg.png" alt="image-20200724120502719"></p>
<p>A aplica√ß√£o receber√° requisi√ß√µes HTTP pela porta <strong>5000/tcp</strong>. Vamos ver se ela est√° aberta.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ sudo netstat -putan | grep <span style="color:#ae81ff">500</span>
...
tcp        <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span> 0.0.0.0:5000            0.0.0.0:*               LISTEN      1926/python
tcp        <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span> 0.0.0.0:5001            0.0.0.0:*               LISTEN      1926/python
tcp6       <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span> :::5000                 :::*                    LISTEN      1926/python
</code></pre></div><p>Localmente, voc√™ conseguir√° acessar pelo link <code>https://localhost:5000/</code></p>
<p><img src="https://res.cloudinary.com/dtr6hzxnx/image/upload/v1595896233/blog/image-20200724121027822_kuowtf.png" alt="image-20200724121027822"></p>
<p>Mas remotamente, ainda temos um problema de certificado. =(</p>
<p><img src="https://res.cloudinary.com/dtr6hzxnx/image/upload/v1595896271/blog/image-20200724121138496_vhgkyn.png" alt="image-20200724121138496"></p>
<p>Vamos ter que corrigir o certificado. Antes vamos entrar na pasta de certificados do Infection Monkey e fazer um backup dos arquivos atuais</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ cd /var/monkey/monkey_island/cc
$ sudo mkdir old_cert
$ sudo mv server.crt old_cert/
$ sudo mv server.csr old_cert/
$ sudo mv server.key old_cert/
</code></pre></div><p>Ainda na pasta  <code>/var/monkey/monkey_island/cc</code> , vamos criar um certificado novo.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ sudo openssl req -x509 -nodes -days <span style="color:#ae81ff">365</span> -newkey rsa:2048 -keyout server.key -out server.crt
</code></pre></div><p>Voc√™ ver√° uma sa√≠da como a abaixo. Voc√™ pode ir digitando <code>ENTER</code> e confirmando tudo.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">Generating a RSA private key
............+++++
......+++++
writing new private key to <span style="color:#e6db74">&#39;server.key&#39;</span>
-----
You are about to be asked to enter information that will be incorporated
into your certificate request.
What you are about to enter is what is called a Distinguished Name or a DN.
There are quite a few fields but you can leave some blank
For some fields there will be a default value,
If you enter <span style="color:#e6db74">&#39;.&#39;</span>, the field will be left blank.
-----
Country Name <span style="color:#f92672">(</span><span style="color:#ae81ff">2</span> letter code<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>AU<span style="color:#f92672">]</span>:br
State or Province Name <span style="color:#f92672">(</span>full name<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Some-State<span style="color:#f92672">]</span>:sp
Locality Name <span style="color:#f92672">(</span>eg, city<span style="color:#f92672">)</span> <span style="color:#f92672">[]</span>:osasco
Organization Name <span style="color:#f92672">(</span>eg, company<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Internet Widgits Pty Ltd<span style="color:#f92672">]</span>:Perifa
Organizational Unit Name <span style="color:#f92672">(</span>eg, section<span style="color:#f92672">)</span> <span style="color:#f92672">[]</span>:
Common Name <span style="color:#f92672">(</span>e.g. server FQDN or YOUR name<span style="color:#f92672">)</span> <span style="color:#f92672">[]</span>:
Email Address <span style="color:#f92672">[]</span>:

</code></pre></div><p>Reinicie o servi√ßo da aplica√ß√£o.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ sudo systemctl restart monkey-island
</code></pre></div><p>N√£o √© necess√°rio configurar para que os servi√ßos iniciem automaticamente, na instala√ß√£o isso j√° √© configurado.</p>
<p>Pronto! Tudo configurado! Agora √© poss√≠vel acessar remotamente.</p>
<p><img src="https://res.cloudinary.com/dtr6hzxnx/image/upload/v1595896311/blog/image-20200724132251477_dhwjg7.png" alt="image-20200724132251477"></p>
<h1 id="configura√ß√£o-e-execu√ß√£o-dos-ataques">Configura√ß√£o e execu√ß√£o dos ataques</h1>
<p>Agora com o servidor devidamente configurado, agora vem a parte mais f√°cil, por incr√≠vel que pare√ßa.</p>
<p>Logo de inicio voc√™ ter√° duas op√ß√µes para rodar o Monkey, neste caso vamos combinar o scan realizado pelo servidor e realizar o deploy  do client em um dos desktops Windows 10.</p>
<p><img src="https://res.cloudinary.com/dtr6hzxnx/image/upload/v1595896650/blog/image-20200724132819883_xmbzgf.png" alt="image-20200724132819883"></p>
<p>Primeiro vamos baixar o cliente no Windows 10.</p>
<p><img src="https://res.cloudinary.com/dtr6hzxnx/image/upload/v1595896683/blog/image-20200724132941427_vdeij7.png" alt="image-20200724132941427"></p>
<p>Voc√™ poder√° executar o comando gerando em PowerShell no Windows, ou simplesmente baixar o cliente pela URL identificada no comando, <code>https://192.168.210.99:5000/api/monkey/download/monkey-windows-64.exe</code>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">powershell <span style="color:#66d9ef">[System.Net.ServicePointManager]</span>::ServerCertificateValidationCallback = {$true}; (New-Object System.Net.WebClient).DownloadFile(<span style="color:#e6db74">&#39;https://192.168.210.99:5000/api/monkey/download/monkey-windows-64.exe&#39;</span>,<span style="color:#e6db74">&#39;.\monkey.exe&#39;</span>); ;Start-Process -FilePath <span style="color:#e6db74">&#39;.\monkey.exe&#39;</span> -ArgumentList <span style="color:#e6db74">&#39;m0nk3y -s 192.168.210.99:5000&#39;</span>;
</code></pre></div><p>Devido a natureza do software o Windows Defender imediatamente bloquear√° o download, voc√™ dever√° autorizar.</p>
<p><img src="https://res.cloudinary.com/dtr6hzxnx/image/upload/v1595896038/blog/image-20200724135406772_e8pxb4.png" alt="image-20200724135406772"></p>
<p><img src="https://res.cloudinary.com/dtr6hzxnx/image/upload/v1595896038/blog/image-20200724135420310_txhavm.png" alt="image-20200724135420310"></p>
<p>J√° no terminal do PowerShell, execute o seguinte comando no diret√≥rio onde o cliente foi baixado. Lembrando que a aplica√ß√£o Monkey Island est√° no servidor <strong>192.168.210.99</strong>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">.\monkey-windows-64.exe -ArgumentList m0nk3y -s 192.168.210.99<span style="color:#960050;background-color:#1e0010">:</span>5000

Bootloader starting.
Gathering network parameters.
Host Name . . . . . . . . . <span style="color:#960050;background-color:#1e0010">:</span> WKS01
IP Address. . . . . . . . . <span style="color:#960050;background-color:#1e0010">:</span> 192.168.210.10
IP Address. . . . . . . . . <span style="color:#960050;background-color:#1e0010">:</span> 172.16.210.138
Windows version<span style="color:#960050;background-color:#1e0010">:</span> windows8_or_greater
Sending request.
192.168.210.99 <span style="color:#960050;background-color:#1e0010">:</span> (null) <span style="color:#960050;background-color:#1e0010">:</span> {<span style="color:#e6db74">&#34;system&#34;</span><span style="color:#960050;background-color:#1e0010">:</span><span style="color:#e6db74">&#34;windows&#34;</span>, <span style="color:#e6db74">&#34;os_version&#34;</span><span style="color:#960050;background-color:#1e0010">:</span><span style="color:#e6db74">&#34;windows8_or_greater&#34;</span>, <span style="color:#e6db74">&#34;hostname&#34;</span><span style="color:#960050;background-color:#1e0010">:</span><span style="color:#e6db74">&#34;WKS01&#34;</span>, <span style="color:#e6db74">&#34;tunnel&#34;</span><span style="color:#960050;background-color:#1e0010">:</span>false, <span style="color:#e6db74">&#34;ips&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> [<span style="color:#e6db74">&#34;192.168.210.10&#34;</span>, <span style="color:#e6db74">&#34;172.16.210.138&#34;</span>]}
Retrieved 17 data bytes<span style="color:#960050;background-color:#1e0010">:</span> {<span style="color:#e6db74">&#34;status&#34;</span><span style="color:#960050;background-color:#1e0010">:</span><span style="color:#e6db74">&#34;RUN&#34;</span>}

Bootloader finished.
Bootloader starting.
Gathering network parameters.
Host Name . . . . . . . . . <span style="color:#960050;background-color:#1e0010">:</span> WKS01
IP Address. . . . . . . . . <span style="color:#960050;background-color:#1e0010">:</span> 192.168.210.10
IP Address. . . . . . . . . <span style="color:#960050;background-color:#1e0010">:</span> 172.16.210.138
Windows version<span style="color:#960050;background-color:#1e0010">:</span> windows8_or_greater
Sending request.
192.168.210.99 <span style="color:#960050;background-color:#1e0010">:</span> (null) <span style="color:#960050;background-color:#1e0010">:</span> {<span style="color:#e6db74">&#34;system&#34;</span><span style="color:#960050;background-color:#1e0010">:</span><span style="color:#e6db74">&#34;windows&#34;</span>, <span style="color:#e6db74">&#34;os_version&#34;</span><span style="color:#960050;background-color:#1e0010">:</span><span style="color:#e6db74">&#34;windows8_or_greater&#34;</span>, <span style="color:#e6db74">&#34;hostname&#34;</span><span style="color:#960050;background-color:#1e0010">:</span><span style="color:#e6db74">&#34;WKS01&#34;</span>, <span style="color:#e6db74">&#34;tunnel&#34;</span><span style="color:#960050;background-color:#1e0010">:</span>false, <span style="color:#e6db74">&#34;ips&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> [<span style="color:#e6db74">&#34;192.168.210.10&#34;</span>, <span style="color:#e6db74">&#34;172.16.210.138&#34;</span>]}
Retrieved 17 data bytes<span style="color:#960050;background-color:#1e0010">:</span> {<span style="color:#e6db74">&#34;status&#34;</span><span style="color:#960050;background-color:#1e0010">:</span><span style="color:#e6db74">&#34;RUN&#34;</span>}

Bootloader finished.
</code></pre></div><p>Pronto! Instantes depois voc√™ ver√° o cliente se comunicando com o servidor.</p>
<p>Ainda na tela Run Monkey, clique em <em><strong>Run on Monkey Island Server</strong></em>.</p>
<p><img src="https://res.cloudinary.com/dtr6hzxnx/image/upload/v1595896038/blog/image-20200727203828840_wetpoq.png" alt="image-20200727203828840"></p>
<p>Agora voc√™ ver√° a intera√ß√£o entre o cliente e server, e a partir de agora os <em>monkeys</em> come√ßar√£o a vasculhar a rede!</p>
<p><img src="https://res.cloudinary.com/dtr6hzxnx/image/upload/v1595896038/blog/image-20200724135839537_ubwlui.png" alt="image-20200724135839537"></p>
<p>Como dito anteriormente, adicionei nas configura√ß√µes de bruteforce uma credencial v√°lida para ajudar na demonstra√ß√£o, e no fim tivemos o seguinte cen√°rio, onde todas as m√°quinas do dom√≠nio foram exploradas com sucesso.</p>
<p><img src="https://res.cloudinary.com/dtr6hzxnx/image/upload/v1595896038/blog/a41a7f81-4ac9-4a37-8c61-94b1ee100ce7_ujwy0e.jpg" alt="a41a7f81-4ac9-4a37-8c61-94b1ee100ce7"></p>
<h1 id="mais-sobre-configura√ß√µes">Mais sobre configura√ß√µes</h1>
<p>Em <strong>Configura√ß√µes</strong> √© poss√≠vel realizar ajustes como:</p>
<ul>
<li>Determinar quais t√©cnicas do MITRE ATT&amp;CK ser√£o utilizadas;</li>
<li>Configurar lista de credenciais (usu√°rios e senhas) ser√£o utilizados nos ataques de bruteforce e hashes, se os possuir;</li>
<li>Configura√ß√µes de rede, por exemplo quantidade de saltos permitidos e redes escopo;</li>
<li>Execu√ß√£o de scripts customizados (Linux ou Windows) ap√≥s cada explora√ß√£o com sucesso;</li>
<li>Portas a serem escaneadas nas redes alvo;</li>
<li>Quais exploits ser√£o utilizados.</li>
</ul>
<h1 id="relat√≥rios">Relat√≥rios</h1>
<p>O Infection Monkey lhe fornecer√° os seguinte relat√≥rios. Clique nos links para baixar um exemplo em PDF.</p>
<ul>
<li><a href="https://1drv.ms/b/s!Ag5lSD8BYF9ogew2V2twhOL-q2bdBw?e=ZVDlLR">Security Report</a></li>
<li><a href="https://1drv.ms/b/s!Ag5lSD8BYF9ogew16x4DMqEvzYq-cg?e=W2Lzkc">Zero Trust Report</a>
<ul>
<li>Mais sobre em <a href="https://www.guardicore.com/infectionmonkey/zero-trust.html">https://www.guardicore.com/infectionmonkey/zero-trust.html</a></li>
</ul>
</li>
<li><a href="https://1drv.ms/b/s!Ag5lSD8BYF9ogew0B55JxzTsnVp_UQ?e=V7qFIU">ATT&amp;CK Report</a></li>
</ul>
<p><strong>Security Report</strong></p>
<p><img src="https://res.cloudinary.com/dtr6hzxnx/image/upload/v1595896041/blog/tt_2020-07-27_13-57-23-1595870140628_omccvk.png" alt="tt_2020-07-27_13-57-23"></p>
<p><strong>Zero Trust Report</strong></p>
<p><img src="https://res.cloudinary.com/dtr6hzxnx/image/upload/v1595896040/blog/tt_2020-07-27_13-57-40-1595870135727_pjulcw.png" alt="tt_2020-07-27_13-57-40"></p>
<p><strong>ATT&amp;CK Report</strong></p>
<p><img src="https://res.cloudinary.com/dtr6hzxnx/image/upload/v1595896040/blog/tt_2020-07-27_13-57-53_cgjht8.png" alt="tt_2020-07-27_13-57-53"></p>
<h1 id="conclus√£o-">Conclus√£o ü§î</h1>
<p>O <em><strong>Infection Monkey</strong></em> pode ser um grande aliado em <em>assessments</em> de primeiro n√≠vel, realizando todo o trabalho a partir de um bot√£o de START!</p>
<p>Obviamente esta solu√ß√£o jamais ir√° substituir um trabalho de resili√™ncia completo com profissionais experientes e especialistas nas solu√ß√µes que comp√µem o ambiente a ser testado. S√£o esses profissionais que s√£o capazes de &ldquo;tirar coelhos da cartola&rdquo; quando normalmente n√£o se v√™ qualquer possibilidade de uma escala√ß√£o de privil√©gio. üêá</p>
              
            </div>
          </div>
          <div id="post-footer" class="post-footer main-content-wrap">
            
              
                
                
                  <div class="post-footer-tags">
                    <span class="text-color-light text-small">TAGGED IN</span><br/>
                    
  <a class="tag tag--primary tag--small" href="https://tiagotavares.io/tags/red-team/">red team</a>

  <a class="tag tag--primary tag--small" href="https://tiagotavares.io/tags/breach-and-attack-simulation/">breach and attack simulation</a>

  <a class="tag tag--primary tag--small" href="https://tiagotavares.io/tags/security/">security</a>

  <a class="tag tag--primary tag--small" href="https://tiagotavares.io/tags/infection-monkey/">infection monkey</a>

  <a class="tag tag--primary tag--small" href="https://tiagotavares.io/tags/hacking/">hacking</a>

  <a class="tag tag--primary tag--small" href="https://tiagotavares.io/tags/guardicore/">guardicore</a>

  <a class="tag tag--primary tag--small" href="https://tiagotavares.io/tags/resili%C3%AAncia/">resili√™ncia</a>

                  </div>
                
              
            
            <div class="post-actions-wrap">
  
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="https://tiagotavares.io/2020/07/photographer-1-vulnhub/" data-tooltip="Photographer: 1 - Vulnhub ">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="https://tiagotavares.io/2020/07/como-carregar-atividades-manualmente-do-rel%C3%B3gio-garmin-para-o-strava/" data-tooltip="Como carregar atividades manualmente do rel√≥gio Garmin para o Strava">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://tiagotavares.io/2020/07/breach-and-attack-simulation-com-infection-monkey/">
              <i class="fa fa-facebook-official"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=https://tiagotavares.io/2020/07/breach-and-attack-simulation-com-infection-monkey/">
              <i class="fa fa-twitter"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=https://tiagotavares.io/2020/07/breach-and-attack-simulation-com-infection-monkey/">
              <i class="fa fa-google-plus"></i>
            </a>
          </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#disqus_thread">
            <i class="fa fa-comment-o"></i>
          </a>
        </li>
      
      <li class="post-action">
        
          <a class="post-action-btn btn btn--default" href="#">
        
          <i class="fa fa-list"></i>
        </a>
      </li>
    </ul>
  
</div>

            
              
                <div id="disqus_thread">
  <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
              
            
          </div>
        </article>
        <footer id="footer" class="main-content-wrap">
  <span class="copyrights">
    &copy; 2021 Tiago Tavares. All Rights Reserved
  </span>
</footer>

      </div>
      <div id="bottom-bar" class="post-bottom-bar" data-behavior="4">
        <div class="post-actions-wrap">
  
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="https://tiagotavares.io/2020/07/photographer-1-vulnhub/" data-tooltip="Photographer: 1 - Vulnhub ">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="https://tiagotavares.io/2020/07/como-carregar-atividades-manualmente-do-rel%C3%B3gio-garmin-para-o-strava/" data-tooltip="Como carregar atividades manualmente do rel√≥gio Garmin para o Strava">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://tiagotavares.io/2020/07/breach-and-attack-simulation-com-infection-monkey/">
              <i class="fa fa-facebook-official"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=https://tiagotavares.io/2020/07/breach-and-attack-simulation-com-infection-monkey/">
              <i class="fa fa-twitter"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=https://tiagotavares.io/2020/07/breach-and-attack-simulation-com-infection-monkey/">
              <i class="fa fa-google-plus"></i>
            </a>
          </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#disqus_thread">
            <i class="fa fa-comment-o"></i>
          </a>
        </li>
      
      <li class="post-action">
        
          <a class="post-action-btn btn btn--default" href="#">
        
          <i class="fa fa-list"></i>
        </a>
      </li>
    </ul>
  
</div>

      </div>
      <div id="share-options-bar" class="share-options-bar" data-behavior="4">
  <i id="btn-close-shareoptions" class="fa fa-close"></i>
  <ul class="share-options">
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Ftiagotavares.io%2F2020%2F07%2Fbreach-and-attack-simulation-com-infection-monkey%2F">
          <i class="fa fa-facebook-official"></i><span>Share on Facebook</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=https%3A%2F%2Ftiagotavares.io%2F2020%2F07%2Fbreach-and-attack-simulation-com-infection-monkey%2F">
          <i class="fa fa-twitter"></i><span>Share on Twitter</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://plus.google.com/share?url=https%3A%2F%2Ftiagotavares.io%2F2020%2F07%2Fbreach-and-attack-simulation-com-infection-monkey%2F">
          <i class="fa fa-google-plus"></i><span>Share on Google&#43;</span>
        </a>
      </li>
    
  </ul>
</div>
<div id="share-options-mask" class="share-options-mask"></div>
    </div>
    
    <div id="about">
  <div id="about-card">
    <div id="about-btn-close">
      <i class="fa fa-remove"></i>
    </div>
    
      <img id="about-card-picture" src="https://www.gravatar.com/avatar/e68e9fb3fa89ea576f47c7ef05d17448?s=110" alt="Author&#39;s picture" />
    
    <h4 id="about-card-name">Tiago Tavares</h4>
    
      <div id="about-card-bio">Eternal student, cybersecurity pro, husband, runner.</div>
    
    
      <div id="about-card-job">
        <i class="fa fa-briefcase"></i>
        <br/>
        Cybersecurity Consultant
      </div>
    
    
      <div id="about-card-location">
        <i class="fa fa-map-marker"></i>
        <br/>
        Brazil
      </div>
    
  </div>
</div>

    

    
  
    <div id="cover" style="background-image:url('https://res.cloudinary.com/dtr6hzxnx/image/upload/v1589318923/last_jedi1_ybpjeb.jpg');"></div>
  


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js" integrity="sha256-/BfiIkHlHoVihZdc6TFuj7MmJ0TWcWsMXkeDFwhi0zw=" crossorigin="anonymous"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.7/js/jquery.fancybox.min.js" integrity="sha256-GEAnjcTqVP+vBp3SSc8bEDQqvWAZMiHyUSIorrWwH50=" crossorigin="anonymous"></script>


<script src="https://tiagotavares.io/js/script-pcw6v3xilnxydl1vddzazdverrnn9ctynvnxgwho987mfyqkuylcb1nlt.min.js"></script>


<script lang="javascript">
window.onload = updateMinWidth;
window.onresize = updateMinWidth;
document.getElementById("sidebar").addEventListener("transitionend", updateMinWidth);
function updateMinWidth() {
  var sidebar = document.getElementById("sidebar");
  var main = document.getElementById("main");
  main.style.minWidth = "";
  var w1 = getComputedStyle(main).getPropertyValue("min-width");
  var w2 = getComputedStyle(sidebar).getPropertyValue("width");
  var w3 = getComputedStyle(sidebar).getPropertyValue("left");
  main.style.minWidth = `calc(${w1} - ${w2} - ${w3})`;
}
</script>

<script>
$(document).ready(function() {
  hljs.configure({ classPrefix: '', useBR: false });
  $('pre.code-highlight > code, pre > code').each(function(i, block) {
    if (!$(this).hasClass('codeblock')) {
      $(this).addClass('codeblock');
    }
    hljs.highlightBlock(block);
  });
});
</script>


  
    
      <script>
        var disqus_config = function () {
          this.page.url = 'https:\/\/tiagotavares.io\/2020\/07\/breach-and-attack-simulation-com-infection-monkey\/';
          
            this.page.identifier = '\/2020\/07\/breach-and-attack-simulation-com-infection-monkey\/'
          
        };
        (function() {
          
          
          if (window.location.hostname == "localhost") {
            return;
          }
          var d = document, s = d.createElement('script');
          var disqus_shortname = 'tiagotavares-io';
          s.src = '//' + disqus_shortname + '.disqus.com/embed.js';

          s.setAttribute('data-timestamp', +new Date());
          (d.head || d.body).appendChild(s);
        })();
      </script>
    
  




    
  </body>
</html>

